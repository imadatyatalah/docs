---
title: 'Referential actions'
metaTitle: 'Referential actions (Preview)'
metaDescription: 'Referential actions let you define the update and delete behavior of related models on the database level'
tocDepth: 2
preview: true
---

<TopBlock>

In [2.26.0]() and later, you can define **referential actions** on your relation fields. Referential actions determine what should happen to a record when a related record is deleted or updated.

In the following example, adding `onDelete: Cascade` to the `author` field on the `Post` model means that deleting the `User` record will also delete all related `Post` records.

```prisma highlight=4;normal
model Post {
  id        Int     @id @default(autoincrement())
  title     String
  author    User    @relation(fields: [authorId], references: [id], onDelete: Cascade)
  authorId  Int
}

model User {
  id    Int    @id @default(autoincrement())
  posts Post[]
}
```

If you do not specify a referential action, Prisma [uses a default](#referential-action-defaults).

</TopBlock>

## Enable the <inlinecode>referentialActions</inlinecode> Preview feature

Referential actions are a Preview feature. To enable the `referentialActions` Preview feature:

1. [Upgrade to Prisma version 2.26.0](../../../../guides/upgrade-guides/upgrading-to-latest).
2. Adding `referentialActions` to the `previewFeatures` field of the Prisma Client [`generator`](../../../../reference/api-reference/prisma-schema-reference#generator) block in the `prisma.schema` file:

```prisma file=schema.prisma
generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["referentialActions"]
}
```

3. Follow one of two [upgrade paths for referential actions](../../../../guides/upgrade-guides/upgrading-to-referential-actions).

<Admonition type="alert">

It is extremely important that you follow an [upgrade path for referential actions](../../../../guides/upgrade-guides/upgrading-to-referential-actions). The `referentialAction` Preview feature **removes the safety net in Prisma Client that prevents cascading deletes at runtime**. If you enable the feature _without upgrading your database_, the [old default action]() - `ON DELETE CASCADE` - becomes active. This may result in cascading deletes that you did not expect.

</Admonition>

## Using referential actions

Referential actions are constraints that define how a referenced record is handled by the database when you update or delete records. This includes `delete`, `deleteMany`, `update`, and `updateMany`.

Referential actions are defined in the [`@relation`](../../../../reference/api-reference/prisma-schema-reference#relation) attribute and represent a **foreign key constraint** in the underlying database. If you do not specify a referential action, [Prisma falls back to a default](#referential-action-defaults).

The following model defines a 1-m relation between `User` and `Post` and a n-m relation between `Post` and `Tag`, with explicitly defined referential actions:

```prisma highlight=10,16-17;normal
model User {
  id    Int    @id @default(autoincrement())
  posts Post[]
}

model Post {
  id     Int           @id @default(autoincrement())
  title  String
  tags   TagOnPosts[]
  User   User?         @relation(fields: [userId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  userId Int?
}

model TagOnPosts {
  id     Int   @id @default(autoincrement())
  post   Post? @relation(fields: [postId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  tag    Tag?  @relation(fields: [tagId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  postId Int?
  tagId  Int?
}

model Tag {
  id    Int           @id @default(autoincrement())
  name  String        @unique
  posts TagOnPosts[]
}
```

* If you delete a `Tag`, the corresponding tag assignment is also deleted `TagOnPost` (`Cascade`)
* If you delete a `User`, the author is removed from all posts (`SetNull`) - `User` and `userId` must be optional

Prisma supports the following referential actions:

- [`Cascade`](#cascade)
- [`Restrict`](#restrict)
- [`NoAction`](#noaction)
- [`SetNull`](#setnull)
- [`SetDefault`](#setdefault)

### Referential action defaults

If you do not specify a referential action, Prisma uses the following defaults:

| Clause     | Optional relations | Mandatory relations |
| :--------- | :----------------- | :------------------ |
| `onDelete` | `SetNull`          | `Restrict`          |
| `onUpdate` | `Cascade`          | `Cascade`           |

For example - in the following schema, all `Post` records must be connected to an `author`. The schema **does not explicitly define referential actions** on the `author` field, which means that default referential actions apply (see SQL tab):

<TabbedContent tabs={[<FileWithIcon text="schema.prisma" icon="prisma"/>, <FileWithIcon text="SQL" icon="database"/>]}>
<tab>

```prisma highlight=4;normal
model Post {
  id        Int     @id @default(autoincrement())
  title     String
  author    User    @relation(fields: [authorId], references: [id])
  authorId  Int
}

model User {
  id    Int         @id @default(autoincrement())
  posts Post[]
}
```

</tab>
<tab>

```sql highlight=5;normal
CREATE TABLE "Post" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "title" TEXT NOT NULL,
    "authorId" INTEGER NOT NULL,
    FOREIGN KEY ("authorId") REFERENCES "User" ("id") ON DELETE RESTRICT ON UPDATE CASCADE
);

CREATE TABLE "User" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT
);
```

</tab>
</TabbedContent>

## Caveats

The following caveats apply:

*  Referential actions are **not currently** supported on [implicit many-to-many relations](./#implicit-vs-explicit-many-to-many-relations). To use referential actions, you must define an explicit many-to-many relation and define your referential actions on the [join table](./#how-to-use-a-relation-table-with-a-many-to-many-relationship).

## Types of referential actions

### Cascade

When used with `onDelete`, The `Cascade` action deletes all records that are dependant on the record being deleted.

When used with `onUpdate`, it updates the relation scalar field if the referenced scalar fields of the dependant record are updated.

#### Example usage

```prisma file=schema.prisma highlight=4;add
model Post {
  id        Int     @id @default(autoincrement())
  title     String
  author    User    @relation(fields: [authorId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  authorId  Int
}

model User {
  id    Int    @id @default(autoincrement())
  posts Post[]
}
```

<Admonition type="info">

`onUpdate` defaults to `Cascade` when not set. This applies to both **optional** and **required** relations. `onDelete` defaults to `Cascade` on **required** relations.

</Admonition>

##### Result of using `Cascade`?

If a `User` record is deleted, then their posts are deleted too. If a users id is updated, then the corresponding `authorId` is also updated.

### Restrict

The `Restrict` action will prevent the update or deletion of any parent records which have connected children and throw an error.

> **Note**: The children records can still be deleted

#### Example usage

```prisma file=schema.prisma highlight=4;add
model Post {
  id        Int     @id @default(autoincrement())
  title     String
  author    User    @relation(fields: [authorId], references: [id], onDelete: Restrict)
  authorId  Int
}

model User {
  id    Int    @id @default(autoincrement())
  posts Post[]
}
```

##### Result of using `Restrict`?

If a `User` has a related post in the `Post` table you will **not** be able to delete the `User`, and you will receive a runtime error. You will be able to delete (all) the `Post`s however.

<Admonition type="warning">

The `Restrict` action is not is **not** available on [SQL Server](../../../database-connectors/microsoft-sql-server) and will trigger a schema validation error. Instead, you can use [`NoAction`](#noaction), which produces the same result.

</Admonition>

### NoAction

The `NoAction` action is similar to `Restrict` in that it will prevent the update or deletion of any records which are connected and throw an error. The difference between the two is dependant on the database being used. But in general they both have the same functionality.

In Postgres however, `NoAction` defers the check until later in the transaction.

TODO::: add SQLSERVER, MYSQL

#### Example usage

```prisma file=schema.prisma highlight=4;add
model Post {
  id        Int     @id @default(autoincrement())
  title     String
  author    User    @relation(fields: [authorId], references: [id], onDelete: NoAction)
  authorId  Int
}

model User {
  id    Int    @id @default(autoincrement())
  posts Post[]
}
```

##### Result of using `NoAction`?

If a `User` has a related post in the `Post` table you will **not** be able to delete them. This will result in a runtime error.

### SetNull

The `SetNull` action will set relation [scalar fields](../data-model#scalar-fields) to null if the relation is updated or deleted. If one or more of the relations scalar fields are required a runtime error will be thrown.

```prisma file=schema.prisma highlight=4;add
model Post {
  id        Int     @id @default(autoincrement())
  title     String
  author    User    @relation(fields: [authorId], references: [id], onDelete: SetNull)
  authorId  Int
}

model User {
  id    Int    @id @default(autoincrement())
  posts Post[]
}
```

##### Result of using `SetNull`?

If a `User` is deleted then the corresponding `authorId` field in the `Post` table will be set to `NULL`. It will be left in the database, floating there without a connection to any `User`.

### SetDefault

The `SetDefault` action will set relation [scalar fields](./#annotated-relation-fields-and-relation-scalar-fields) to their default values upon updated or deletion of a related record. If no defaults are provided for any of the scalar fields, a runtime error will be thrown.

```prisma file=schema.prisma highlight=4;add
model Post {
  id        Int     @id @default(autoincrement())
  title     String
  author    User    @relation(fields: [authorId], references: [id], onDelete: SetDefault)
  authorId  Int
}

model User {
  id    Int    @id @default(autoincrement())
  posts Post[]
}
```

##### Result of using `SetDefault`?

If a `User` is deleted then the corresponding `authorId` field in the `Post` table will be set to its default value.

## Behavior in >2.25.0 or without Preview flag <inlinecode>referentialActions</inlinecode>

<a id="current"></a>

The following behavior applies in 2.25.0 and earlier, and 2.26.0 _without_ the `referentialActions` preview flag.

When invoking the [`delete()`](../../../../guides/database/advanced-database-tasks/cascading-deletes/postgresql#91-validating-restrict) or [`deleteAll()`](../../prisma-client/crud#delete-all-records) methods using the Prisma Client, a runtime check is performed and the deletion of records prevented if they are referencing related objects. **This prevents cascade behavior**.

The current behavior, without upgrading and enabling the feature flag, does not allow setting referential actions at all. Only the below defaults are considered:

- `ON DELETE CASCADE` - Does not run due to the Prisma Client runtime check
- `ON UPDATE CASCADE` - When a users `id` is updated, the corresponding `authorId` on the `Posts` table is updated too.

If you need to actually use the cascade behavior configured in the database, you _can_ use [`$raw`](../../prisma-client/raw-database-access) SQL queries to [delete multiple referenced records](../../prisma-client/crud#deleting-all-data-with-raw-sql--truncate) (such as users blog posts) and the deletion will be successful. This is because the Prisma Client will **not** perform runtime checks on raw queries.
